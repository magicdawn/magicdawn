## 术语



### 质数

一个数只有 `1` 和 `它本身` 两个因子, 就是质数. 例如 `2` / `3` / `5` / `7` / `11` ...

### 两个数互质

>  两个正整数，除了1以外，没有其他公因子

### 互质数个数

给定一个数 n, 比 n 小, 与 n 互质的数的个数

> 任意给定正整数n，请问在小于等于n的正整数之中，有多少个与n构成互质关系？（比如，在1到8之中，有多少个数与8构成互质关系？）

 表示为 `φ(n)` , 计算方法就是欧拉函数, 这个符号太难打, 这里写为 `ou(n)` = `zhi_count(n)`



`ou(n)` =

- n = 1, `ou(n) = 1`

- n 为质数, `ou(n) = n-1`

- n = p^k, `ou(n)` = `p^k - p^(k-1)` = `(p^k)(1 - 1/p)`

- 乘法结合: n=p*q 且 p & q互质, `ou(n)` = `ou(p * q)` = `ou(p)` * `ou(q)`

  

### 欧拉定理

- a 与 n 互质, 则下面式子成立

```
a ^ (ou(n)) = 1(mod  n)
```



### RSA

- 现有互质 p & q
- n = p * q
- ou(n) = `r` = (p-1) * (q-1)

假设有整数 e 与 `ou(n)` = r 互质, 则根据欧拉定理

```
e ^ (ou(r)) = ed = 1(mod r)
d = e ^ (ou(r) - 1)
```



于是有这么几个数

- p / q /n
- r = ou(n)
- e / d



结果

- 公钥 `(n, e) `
- 私钥 `(n, d)`

Tips

- 其实 e & d 可以互换, 留一个作为私钥, 一个作为公钥即可
- 但是由 openssl 生成的 pem, e 是固定值. 所以e是公开的, 故 e 放出去作为公钥. 
- e & d, 一个加密的, 另一个可以解密.
  - 在 ssl 传送内容, 由 client 的 **公钥加密** , client **私钥解密**, 因为私钥保密, 故只有 client 能解开
  - 在 CA / 证书校验 / 签名中. 使用 **私钥加密** , 因为解密解开的内容是  public key / 内容hash, 解开内容逻辑上是公开的, 使用**公钥解密**.
  - 系统内置了很多 CA 的公钥, 服务器证书其实是将 服务器公钥用CA 私钥加密的内容.